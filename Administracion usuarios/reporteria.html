<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reportería - Taller La Unión</title>
  <style>
    /* Palette variables (Classic Red Palette) */
    :root{
      --black-1:#0B090A;
      --black-2:#161A1D;
      --red-2:#BA181B;
      --accent:#E5383B;
      --muted-1:#6b6464;
      --muted-2:#D3D3D3;
      --offwhite:#F5F3F4;
      --white:#FFFFFF;

      --glass: rgba(0,0,0,0.03);
      --card-radius:12px;
      --shadow: 0 8px 24px rgba(22,26,29,0.06);
    }

    /* Reset & base */
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    html,body{height:100%;margin:0;background:var(--white);color:var(--black-2);}

    .app{
      max-width:1200px;margin:36px auto;padding:28px;background:linear-gradient(180deg, var(--offwhite), var(--white));border-radius:14px;box-shadow:var(--shadow);
    }

    header{display:flex;align-items:center;justify-content:space-between;padding-bottom:18px;border-bottom:1px solid rgba(22,26,29,0.06)}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--red-2),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;color:var(--white);box-shadow:0 6px 18px rgba(229,56,59,0.12)}
    h1{font-size:20px;margin:0;color:var(--black-2)}
    p.lead{margin:0;color:var(--muted-1);font-size:13px}

    .controls{display:flex;gap:12px;align-items:center}
    .control{background:var(--glass);padding:8px;border-radius:10px;display:flex;gap:8px;align-items:center}
    input[type="date"], select{background:transparent;border:0;color:var(--black-2);outline:none;padding:6px 8px}
    .label-inline{font-size:12px;color:var(--muted-1);margin-right:6px}
    button.primary{background:var(--accent);border:0;padding:8px 12px;border-radius:10px;color:var(--white);cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(22,26,29,0.06);padding:8px 10px;border-radius:10px;color:var(--black-2);cursor:pointer}

    main{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}

    /* Sidebar */
    aside{padding:18px;background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));border-radius:12px}
    .section-title{font-weight:700;margin-bottom:12px;color:var(--black-2);font-size:13px}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted-1)}
    .field{margin-bottom:12px}
    .select, .input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(22,26,29,0.04);background:transparent;color:var(--black-2)}
    .report-list{display:grid;gap:8px}
    .report-item{padding:10px;border-radius:10px;background:linear-gradient(90deg, rgba(229,56,59,0.03), rgba(255,255,255,0.6));display:flex;justify-content:space-between;align-items:center;cursor:pointer;border:1px solid rgba(22,26,29,0.03)}
    .report-item:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(22,26,29,0.04)}
    .tag{font-size:12px;padding:6px 8px;border-radius:8px;background:var(--offwhite);color:var(--red-2)}

    /* Workspace */
    .workspace{min-height:420px;padding:18px;background:transparent;border-radius:12px}
    .grid{display:grid;grid-template-columns:repeat(2, 1fr);gap:14px}
    .card{background:var(--white);color:var(--black-2);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(22,26,29,0.04);border:1px solid rgba(22,26,29,0.03)}
    .card h3{margin:0 0 10px 0;font-size:15px}
    .card small{color:var(--muted-1)}

    .table-wrap{overflow:auto;margin-top:10px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 10px;text-align:left;border-bottom:1px solid rgba(0,0,0,0.06)}
    th{background:linear-gradient(90deg,var(--offwhite),var(--muted-2));font-weight:700}

    .btns{display:flex;gap:8px;margin-top:10px}
    .btn-export{padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .xls{background:linear-gradient(90deg,#2b6b1d,#549e3b);color:var(--white)}
    .pdf{background:linear-gradient(90deg,var(--red-2),var(--accent));color:var(--white)}

    /* Report cards area (full width under top cards) */
    .reports-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
    .report-card{padding:12px;border-radius:10px;border:1px solid rgba(22,26,29,0.03);background:linear-gradient(180deg, var(--offwhite), var(--white));box-shadow:0 6px 14px rgba(22,26,29,0.03)}

    /* statistics */
    .stat{display:flex;align-items:center;gap:12px}
    .stat .dot{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,var(--red-2),var(--accent));display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:700}
    .stat .meta{font-weight:700}
    .muted{color:var(--muted-1);font-size:12px}

    /* responsive */
    @media (max-width:900px){main{grid-template-columns:1fr} .grid{grid-template-columns:1fr} .reports-grid{grid-template-columns:1fr} .brand h1{font-size:16px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">TU</div>
        <div>
          <h1>Reportería - Taller La Unión</h1>
          <p class="lead">Módulo para generar reportes: contabilidad, clientes, garantías, citas y carga de trabajo.</p>
        </div>
      </div>

      <!-- CONTROLES (Sin botón Generar global) -->
      <div class="controls">
        <div class="control">
          <span class="label-inline">Desde</span>
          <input id="desde" type="date" />
        </div>
        <div class="control">
          <span class="label-inline">Hasta</span>
          <input id="hasta" type="date" />
        </div>
        <div class="control">
          <select id="reportSelect">
            <option value="contabilidad">Contabilidad (Ingresos/Egresos)</option>
            <option value="clientes">Clientes</option>
            <option value="citas_canceladas">Citas canceladas</option>
            <option value="carros_estado">Carros (Arreglados / En proceso / Espera)</option>
            <option value="modelos">Reporte de modelos</option>
            <option value="ingresos_vehiculos">Ingreso de vehículos al taller</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <aside>
        
        <div style="height:10px"></div>
        <div class="section-title">Exportar</div>
        <div class="muted">Selecciona un reporte (arriba o tarjetas) y usa los botones en el área de trabajo para exportar a CSV o imprimir a PDF.</div>
      </aside>

      <section class="workspace">
        <div id="outputArea">
          <div class="grid">
            <div class="card">
              <h3>Resumen rápido</h3>
              <div class="stat">
                <div class="dot">$</div>
                <div>
                  <div class="meta" id="totalIngresos">Ingresos: ₡0</div>
                  <div class="muted">Período seleccionado</div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Trabajos pendientes</h3>
              <div class="muted">Citas activas y tiempos estimados</div>
              <div style="margin-top:8px;font-weight:700" id="pendientesCount">12 vehículos</div>
            </div>

            <!-- Report cards (cada uno tiene su botón Generar) -->
            <div class="card" style="grid-column:span 2">
              <h3>Reportes disponibles</h3>
              <small class="muted">Selecciona el reporte que necesites y presiona Generar en la tarjeta correspondiente.</small>

              <div class="reports-grid" id="reportsGrid">
                <!-- Cards in JS or static markup -->
                <div class="report-card">
                  <h4>Contabilidad</h4>
                  <p class="muted">Ingresos y egresos por periodo. Exporta a XLS o PDF.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('contabilidad')">Generar</button>
                </div>

                <div class="report-card">
                  <h4>Clientes</h4>
                  <p class="muted">Listado de clientes, antigüedad y último servicio.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('clientes')">Generar</button>
                </div>

                <div class="report-card">
                  <h4>Citas canceladas</h4>
                  <p class="muted">Citas canceladas por cliente, motivo y fecha.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('citas_canceladas')">Generar</button>
                </div>

                <div class="report-card">
                  <h4>Carros (estado)</h4>
                  <p class="muted">Arreglados / En proceso / En espera — mecánico y ETA.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('carros_estado')">Generar</button>
                </div>

                <div class="report-card">
                  <h4>Modelos</h4>
                  <p class="muted">Frecuencia por modelo y modelos poco comunes.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('modelos')">Generar</button>
                </div>

                <div class="report-card">
                  <h4>Ingreso de vehículos</h4>
                  <p class="muted">Registro de ingresos (fecha/hora), motivo y estado inicial.</p>
                  <button class="primary" style="width:100%;margin-top:8px" onclick="preset('ingresos_vehiculos')">Generar</button>
                </div>
              </div>
            </div>

            <!-- Tabla principal -->
            <div class="card" style="grid-column:span 2">
              <h3 id="reportTitle">Reporte: Contabilidad</h3>
              <small class="muted" id="reportSubtitle">Muestra de datos. Filtra por fecha y exporta.</small>

              <div class="btns">
                <button class="btn-export xls" onclick="exportTable('xls')">Exportar CSV</button>
                <button class="btn-export pdf" onclick="exportPDF()">Exportar PDF</button>
              </div>

              <div class="table-wrap">
                <table id="reportTable" role="table">
                  <thead id="reportHead">
                    <tr><th>Fecha</th><th>Tipo</th><th>Descripción</th><th>Monto</th><th>Cliente / Vehículo</th></tr>
                  </thead>
                  <tbody>
                    <!-- rows injected by JS -->
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // --- sample dataset (mock) ---
    const datos = [
      {fecha:'2025-11-01', tipo:'Ingreso', desc:'Reparación motor', monto:250000, cliente:'Juan Pérez - Toyota Corolla 2018'},
      {fecha:'2025-11-03', tipo:'Egreso', desc:'Compra repuestos', monto:-45000, cliente:'Stock'},
      {fecha:'2025-11-07', tipo:'Ingreso', desc:'Servicio A/C', monto:60000, cliente:'Ana Gómez - Honda Civic 2020'},
      {fecha:'2025-11-09', tipo:'Ingreso', desc:'Garantía - Reproceso', monto:0, cliente:'Carlos Díaz - Nissan Sentra 2010'},
      {fecha:'2025-11-12', tipo:'Egreso', desc:'Pago proveedor', monto:-120000, cliente:'Proveedor ABC'},
      {fecha:'2025-11-15', tipo:'Ingreso', desc:'Revisión general', monto:80000, cliente:'María Ruiz - Suzuki Swift 2025'},
      {fecha:'2025-11-18', tipo:'Ingreso', desc:'Cambio transmisión', monto:320000, cliente:'Taller externo'},
      {fecha:'2025-11-20', tipo:'Ingreso', desc:'Servicio rápido', monto:25000, cliente:'Luis Vargas - Renault 4 1979'},
      {fecha:'2025-11-22', tipo:'Egreso', desc:'Herramientas', monto:-34000, cliente:'Gastos generales'}
    ];

    const clientes = [
      {id:1,nombre:'Juan Pérez',cedula:'101234567',telefono:'8888-0000',fecha_registro:'2020-02-10',ultimo_servicio:'2025-11-01',total_servicios:12,vehiculos:['Toyota Corolla 2018']},
      {id:2,nombre:'Ana Gómez',cedula:'102345678',telefono:'8888-1111',fecha_registro:'2023-05-01',ultimo_servicio:'2025-11-07',total_servicios:5,vehiculos:['Honda Civic 2020']},
      {id:3,nombre:'María Ruiz',cedula:'103456789',telefono:'8888-2222',fecha_registro:'2025-06-20',ultimo_servicio:'2025-11-15',total_servicios:1,vehiculos:['Suzuki Swift 2025']},
      {id:4,nombre:'Luis Vargas',cedula:'104567890',telefono:'8888-3333',fecha_registro:'2018-01-12',ultimo_servicio:'2025-11-20',total_servicios:20,vehiculos:['Renault 4 1979']},
      {id:5,nombre:'Carlos Díaz',cedula:'105678901',telefono:'8888-4444',fecha_registro:'2019-11-03',ultimo_servicio:'2025-11-09',total_servicios:8,vehiculos:['Nissan Sentra 2010']}
    ];

    const carros = [
      {ingreso:'2025-11-20 08:30',cliente:'Luis Vargas',vehiculo:'Renault 4 1979',estado:'En espera',diagnostico:'Frenos',mecanico:'Mecánico A',eta:'2025-11-25'},
      {ingreso:'2025-11-18 09:15',cliente:'María Ruiz',vehiculo:'Suzuki Swift 2025',estado:'En proceso',diagnostico:'Cambio de aceite',mecanico:'Mecánico B',eta:'2025-11-19'},
      {ingreso:'2025-11-01 10:00',cliente:'Juan Pérez',vehiculo:'Toyota Corolla 2018',estado:'Arreglado',diagnostico:'Reparación motor',mecanico:'Mecánico A',eta:'2025-11-05'}
    ];

    const modelos = [
      {modelo:'Toyota Corolla 2018',cantidad:12},
      {modelo:'Honda Civic 2020',cantidad:9},
      {modelo:'Suzuki Swift 2025',cantidad:2},
      {modelo:'Renault 4 1979',cantidad:1}
    ];

    // helpers
    function numberFormat(n){ if(n=== '' || n===null || n===undefined) return '-'; return (typeof n === 'number') ? n.toLocaleString('es-CR') : n; }

    function renderTable(rows, headers){
      const thead = document.getElementById('reportHead');
      const tbody = document.querySelector('#reportTable tbody');

      // render headers
      thead.innerHTML = '<tr>' + headers.map(h=>`<th>${h}</th>`).join('') + '</tr>';

      // render rows (array of arrays or array of objects with header keys)
      tbody.innerHTML = rows.map(r => {
        if(Array.isArray(r)){
          return '<tr>' + r.map(c=>`<td>${c || '-'}</td>`).join('') + '</tr>';
        } else {
          // assume object: iterate headers keys (safe mapping)
          return '<tr>' + headers.map(h => {
            const key = headerToKey(h);
            let v = (r[key] !== undefined) ? r[key] : '-';
            if(key === 'monto' && (v !== '' && v !== '-' && v !== undefined)) v = numberFormat(v);
            return `<td>${v}</td>`;
          }).join('') + '</tr>';
        }
      }).join('');
    }

    function headerToKey(h){
      // map header text to object keys used in datasets
      const map = {
        'Fecha':'fecha', 'Tipo':'tipo', 'Descripción':'desc', 'Monto':'monto', 'Cliente / Vehículo':'cliente',
        'Cédula':'cedula','Teléfono':'telefono','Fecha registro':'fecha_registro','Último servicio':'ultimo_servicio','Total servicios':'total_servicios','Vehículos':'vehiculos',
        'Ingreso':'ingreso','Estado':'estado','Diagnóstico':'diagnostico','Mecánico':'mecanico','ETA':'eta','Modelo':'modelo','Cantidad':'cantidad','Motivo':'motivo','Hora':'hora'
      };
      return map[h] || h.toLowerCase().replace(/\s+/g,'_');
    }

    // initial render
    function renderInitial(){
      // default contabilidad
      preset('contabilidad', false);
    }

    function preset(key, scroll=true){
      document.getElementById('reportSelect').value = key;
      renderReport();
      if(scroll){
        document.getElementById('reportTitle').scrollIntoView({behavior:'smooth'});
      }
    }

    function renderReport(){
      const sel = document.getElementById('reportSelect').value;
      const desde = document.getElementById('desde').value;
      const hasta = document.getElementById('hasta').value;

      // filter contabilidad by dates if provided
      let filtered = datos.slice();
      if(desde) filtered = filtered.filter(r=> r.fecha >= desde);
      if(hasta) filtered = filtered.filter(r=> r.fecha <= hasta);

      const titleMap = {
        'contabilidad':'Contabilidad (Ingresos / Egresos)',
        'clientes':'Reporte de Clientes',
        'citas_canceladas':'Citas Canceladas',
        'carros_estado':'Carros - Arreglados / En proceso / Espera',
        'modelos':'Reporte de Modelos',
        'ingresos_vehiculos':'Ingreso de Vehículos al Taller'
      };
      document.getElementById('reportTitle').innerText = `Reporte: ${titleMap[sel] || 'Personalizado'}`;
      document.getElementById('reportSubtitle').innerText = 'Datos generados desde el sistema (ejemplo).';

      // switch per report
      if(sel === 'contabilidad'){
        renderTable(filtered, ['Fecha','Tipo','Descripción','Monto','Cliente / Vehículo']);
        calcResumen(filtered);
        return;
      }

      if(sel === 'clientes'){
        // map clientes array to table rows
        renderTable(clientes.map(c => ({
          fecha_registro: c.fecha_registro,
          tipo: 'Cliente',
          desc: c.nombre,
          monto: '',
          cliente: `${c.cedula} — ${c.telefono}`
        })), ['Fecha registro','Tipo','Descripción','Cédula','Teléfono']);
        calcResumen([]);
        return;
      }

      if(sel === 'citas_canceladas'){
        // mock data for canceled
        const rows = [
          {fecha:'2025-11-05',tipo:'Cancelada',desc:'Cliente no asistió',monto:'',cliente:'Pedro López - Toyota'},
          {fecha:'2025-11-11',tipo:'Cancelada',desc:'Reprogramada por taller',monto:'',cliente:'Ana Gómez - Honda'}
        ];
        renderTable(rows, ['Fecha','Tipo','Descripción','Cliente / Vehículo']);
        calcResumen([]);
        return;
      }

      if(sel === 'carros_estado'){
        // carros array mapping
        renderTable(carros.map(c => ({
          ingreso: c.ingreso,
          tipo: '',
          desc: c.vehiculo,
          monto: '',
          cliente: `${c.cliente} — ${c.estado} — ${c.mecanico}`
        })), ['Ingreso','Estado','Vehículo','Diagnóstico','Mecánico']);
        calcResumen([]);
        return;
      }

      if(sel === 'modelos'){
        renderTable(modelos, ['Modelo','Cantidad']);
        calcResumen([]);
        return;
      }

      if(sel === 'ingresos_vehiculos'){
        // combine carros + incoming (use carros as sample)
        renderTable(carros.map(c => ({
          ingreso: c.ingreso,
          tipo: '',
          desc: c.vehiculo,
          monto: '',
          cliente: `${c.cliente} — ${c.diagnostico}`
        })), ['Ingreso','Vehículo','Cliente / Diagnóstico','Mecánico','ETA']);
        calcResumen([]);
        return;
      }

      // fallback
      renderTable(filtered, ['Fecha','Tipo','Descripción','Monto','Cliente / Vehículo']);
      calcResumen(filtered);
    }

    function calcResumen(rows){
      const ingresos = rows.filter(r=>r.tipo==='Ingreso').reduce((s,r)=>s + (r.monto||0),0);
      document.getElementById('totalIngresos').innerText = `Ingresos: ₡${numberFormat(ingresos)}`;
    }

    // --- export simple CSV/XLS ---
    function exportTable(type){
      const head = Array.from(document.querySelectorAll('#reportHead th')).map(th => th.innerText);
      const rows = Array.from(document.querySelectorAll('#reportTable tbody tr')).map(tr => {
        return Array.from(tr.querySelectorAll('td')).map(td => `"${td.innerText.replace(/"/g,'""')}"`).join(',');
      });
      const csv = `"${head.join('","')}"\n` + rows.join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      const sel = document.getElementById('reportSelect').value || 'export';
      a.download = `reporte_${sel}.csv`;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function exportPDF(){
      window.print();
    }

    // init
    renderInitial();
  </script>
</body>
</html>
